<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning App Pro - Final</title>
    <style>
        :root { --primary: #27ae60; --dark: #2c3e50; --bg: #f4f7f6; --paytm: #00baf2; --phonepe: #6739b7; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; text-align: center; color: #333; }
        
        /* Layouts */
        #authPage { display: block; padding: 30px 20px; background: var(--bg); min-height: 100vh; position: fixed; width: 100%; z-index: 1000; top: 0; left: 0; box-sizing: border-box; overflow-y: auto; }
        .auth-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        input { width: 95%; padding: 15px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* Install Button Style */
        .install-banner { background: #f1c40f; color: #000; padding: 12px; border-radius: 10px; margin-bottom: 15px; font-weight: bold; cursor: pointer; border: none; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

        /* Dynamic App Style */
        .dyn-card { background: white; padding: 12px; border-radius: 12px; margin-bottom: 12px; display: flex; align-items: center; text-align: left; box-shadow: 0 3px 8px rgba(0,0,0,0.1); border-left: 5px solid #e67e22; }
        .app-img { width: 50px; height: 50px; border-radius: 10px; margin-right: 12px; object-fit: cover; background: #eee; }
        .app-info { flex-grow: 1; }
        .app-reward { font-weight: bold; color: green; margin-right: 10px; min-width: 45px; text-align: right; }

        /* Offers & Referral */
        .offer-card { background: linear-gradient(135deg, var(--phonepe), #512da8); color: white; padding: 20px; border-radius: 15px; margin: 15px 0; display: flex; align-items: center; justify-content: space-between; cursor: pointer; text-align: left; }
        .paytm-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 15px rgba(0,0,0,0.1); margin: 15px 0; border: 1px solid #ddd; }
        .paytm-header { background: var(--paytm); color: white; padding: 12px; font-weight: bold; }
        .step-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        .refer-box { border: 2px dashed var(--primary); background: #f9fffb; padding: 15px; border-radius: 15px; margin-top: 15px; }

        /* Games */
        #wheel { width: 220px; height: 220px; border-radius: 50%; border: 8px solid #2c3e50; margin: 20px auto; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); background: conic-gradient(#27ae60 0deg 120deg, #e67e22 120deg 240deg, #3498db 240deg 360deg); }
        .w-levels { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .w-btn { padding: 12px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: bold; background: #fff; }
        .w-btn.selected { border-color: var(--primary); background: #eafaf1; color: var(--primary); }
        .hidden-btn { display: none !important; }

        /* Nav & Modal */
        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: none; border-top: 1px solid #ddd; padding: 12px 0; z-index: 100; justify-content: space-around; }
        .nav-item { color: #95a5a6; cursor: pointer; font-size: 14px; font-weight: bold; }
        .active-nav { color: var(--primary); }
        .modal { display: none; position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; margin: 15% auto; padding: 25px; width: 85%; border-radius: 15px; position: relative; }
    </style>
</head>
<body>

    <div id="authPage">
        <h2>Earning App Pro</h2>
        <div class="auth-card">
            <input type="email" id="userEmail" placeholder="Email Address">
            <input type="password" id="userPass" placeholder="Password (Min 6 chars)">
            <div id="regBox">
                <input type="text" id="joinReferCode" placeholder="Refer Code (Optional)">
                <button class="btn" onclick="handleSignUp()">‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</button>
                <p onclick="toggleAuth(false)" style="color:blue; cursor:pointer; margin-top:10px;">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</p>
            </div>
            <div id="logBox" style="display:none;">
                <button class="btn" onclick="handleLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                <p onclick="toggleAuth(true)" style="color:blue; cursor:pointer; margin-top:10px;">‡§®‡§Ø‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</p>
            </div>
        </div>
    </div>

    <div id="mainApp" style="display:none;">
        <div id="homePage" class="page active">
            <h2 onclick="openAdmin()">‡§®‡§Æ‡§∏‡•ç‡§§‡•á! üëã</h2>

            <button class="install-banner" onclick="toggleModal('installModal', true)">
                üì≤ <span>‡§ê‡§™ ‡§ï‡•ã ‡§´‡•ã‡§® ‡§Æ‡•á‡§Ç ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</span>
            </button>

            <div class="card" style="background:var(--dark); color:white;">
                <p>‡§ï‡•Å‡§≤ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏</p>
                <h1>‚Çπ<span id="balHome">0</span></h1>
                <small id="userDisplay"></small>
            </div>

            <div id="dynamicAppList"></div>

            <div class="offer-card" onclick="window.open('https://phon.pe/7yhp93x2', '_blank')">
                <div><b>PhonePe ‡§∞‡§ø‡§µ‡•â‡§∞‡•ç‡§°</b><br><small>‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‚Çπ100 ‡§ú‡•Ä‡§§‡•á‡§Ç</small></div>
                <div style="font-size: 20px; font-weight: bold;">‚Çπ100</div>
            </div>

            <div class="paytm-card">
                <div class="paytm-header">Paytm Offer (‚Çπ100)</div>
                <div class="step-row">
                    <div><b>Step 1: ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</b><br><small>‡§ê‡§™ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</small></div>
                    <button class="btn" style="padding:5px 10px; width:auto; font-size:12px; background:var(--paytm);" onclick="window.open('https://p.paytm.me/xCTH/wbdy7fzi', '_blank')">‚Çπ50</button>
                </div>
                <div class="step-row">
                    <div><b>Step 2: ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</b><br><small>‡§™‡§π‡§≤‡§æ ‚Çπ1 ‡§≠‡•á‡§ú‡•á‡§Ç</small></div>
                    <button class="btn" style="padding:5px 10px; width:auto; font-size:12px; background:var(--paytm);" onclick="window.open('https://p.paytm.me/xCTH/wbdy7fzi', '_blank')">‚Çπ50</button>
                </div>
            </div>

            <div class="refer-box">
                <span>üë´ Refer & Earn (‚Çπ10)</span>
                <div id="displayMyCode" style="font-size:22px; font-weight:bold; margin:10px 0;">...</div>
                <button class="btn" style="padding:10px; font-size:14px; background:var(--dark);" onclick="copyRefer()">Share Link & Code</button>
            </div>
        </div>

        <div id="tasksPage" class="page">
            <h3>‡§ü‡§æ‡§∏‡•ç‡§ï</h3>
            <div class="card" onclick="showCol('spinTask')">üé° ‡§∏‡•ç‡§™‡§ø‡§® ‡§µ‡•ç‡§π‡•Ä‡§≤ <small id="sCount">0/3</small></div>
            <div class="card" onclick="showCol('capTask')">üß© ‡§ï‡•à‡§™‡•ç‡§ö‡§æ ‡§ü‡§æ‡§∏‡•ç‡§ï <small id="cCount">0/3</small></div>
        </div>

        <div id="spinTask" class="page">
            <button class="btn" style="background:#95a5a6; width:auto; padding:5px 15px;" onclick="showCol('tasksPage', 'nTasks')">Back</button>
            <div class="card">
                <div id="wheel"></div>
                <button id="spinBtn" class="btn" onclick="doSpin()">Spin Now</button>
            </div>
        </div>

        <div id="capTask" class="page">
            <button class="btn" style="background:#95a5a6; width:auto; padding:5px 15px;" onclick="showCol('tasksPage', 'nTasks')">Back</button>
            <div class="card">
                <div id="capCode" style="font-size:32px; font-weight:bold; background:#eee; padding:15px; letter-spacing:10px;">...</div>
                <input type="text" id="capInput" placeholder="‡§ï‡•ã‡§° ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç">
                <button class="btn" onclick="doCaptcha()">Submit</button>
            </div>
        </div>

        <div id="withdrawPage" class="page">
            <div style="text-align:right;"><button onclick="toggleModal('historyModal', true)" style="border:none; background:none; font-size:24px;">üïí</button></div>
            <h3>‡§µ‡•â‡§≤‡•á‡§ü</h3>
            <div class="card">
                <p>‡§¨‡•à‡§≤‡•á‡§Ç‡§∏: ‚Çπ<span id="balWithdraw">0</span></p>
                <input type="text" id="upiId" placeholder="UPI ID (Paytm/PhonePe)">
                <div class="w-levels">
                    <div class="w-btn" id="wb10" onclick="selectWAmt(10)">‚Çπ10</div>
                    <div class="w-btn" id="wb50" onclick="selectWAmt(50)">‚Çπ50</div>
                    <div class="w-btn" id="wb100" onclick="selectWAmt(100)">‚Çπ100</div>
                    <div class="w-btn" id="wb200" onclick="selectWAmt(200)">‚Çπ200</div>
                    <div class="w-btn" id="wb500" onclick="selectWAmt(500)">‚Çπ500</div>
                </div>
                <button class="btn" style="background:#e67e22" onclick="handleWithdraw()">Withdraw Now</button>
            </div>
        </div>

        <nav id="bottomNav" class="nav">
            <div class="nav-item active-nav" id="nHome" onclick="showCol('homePage', 'nHome')">üè†<br>‡§π‡•ã‡§Æ</div>
            <div class="nav-item" id="nTasks" onclick="showCol('tasksPage', 'nTasks')">üéØ<br>‡§ü‡§æ‡§∏‡•ç‡§ï</div>
            <div class="nav-item" id="nWithdraw" onclick="showCol('withdrawPage', 'nWithdraw')">üí∞<br>‡§µ‡•â‡§≤‡•á‡§ü</div>
        </nav>
    </div>

    <div id="historyModal" class="modal"><div class="modal-content"><span onclick="toggleModal('historyModal', false)" style="float:right; cursor:pointer; font-size:28px;">&times;</span><h4>‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä</h4><div id="withdrawHistory">Loading...</div></div></div>

    <div id="installModal" class="modal">
        <div class="modal-content">
            <span onclick="toggleModal('installModal', false)" style="float:right; cursor:pointer; font-size:28px;">&times;</span>
            <h3 style="color:var(--primary)">üì≤ ‡§ê‡§™ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</h3>
            <div style="text-align:left; font-size:14px; line-height:1.6;">
                <p><b>1.</b> ‡§ä‡§™‡§∞ ‡§ï‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç <b>3 ‡§°‡•â‡§ü‡•ç‡§∏ (‚ãÆ)</b> ‡§Ø‡§æ ‡§∂‡•á‡§Ø‡§∞ ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                <p><b>2.</b> ‡§Ö‡§¨ <b>'Add to Home Screen'</b> ‡§Ø‡§æ <b>'Install App'</b> ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§</p>
                <p><b>3.</b> ‡§Ö‡§¨ ‡§Ø‡§π ‡§ê‡§™ ‡§Ü‡§™‡§ï‡•á ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§π‡•ã‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§Ü ‡§ú‡§æ‡§è‡§ó‡§æ!</p>
            </div>
            
            <button class="btn" style="margin-top:15px;" onclick="toggleModal('installModal', false)">‡§†‡•Ä‡§ï ‡§π‡•à, ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCPXY9pfY2vrKNEOgenBkYpQqa2SSUQLTk",
            authDomain: "talks-b6037.firebaseapp.com",
            databaseURL: "https://talks-b6037-default-rtdb.firebaseio.com",
            projectId: "talks-b6037",
            storageBucket: "talks-b6037.firebasestorage.app",
            appId: "1:231660762364:web:e1a9589b00d11221d0d379"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.currentUser = null;
        window.bal = 0;
        window.daily = { spins: 0, captchas: 0 };
        window.selectedWAmt = 0;
        let currentCaptcha = "";

        // --- AUTH & NAV ---
        window.toggleAuth = (s) => {
            document.getElementById('regBox').style.display = s?'block':'none';
            document.getElementById('logBox').style.display = s?'none':'block';
        };

        window.handleSignUp = async () => {
            let email = document.getElementById('userEmail').value.trim();
            let pass = document.getElementById('userPass').value.trim();
            if(!email || pass.length < 6) return alert("Email/Password check karen!");
            let sEmail = email.replace(/\./g, ',');
            let myCode = Math.random().toString(36).substring(2,8).toUpperCase();
            let data = { email, password: pass, balance: 0, spins:0, captchas:0, myReferCode: myCode, withdrawn_10: false };
            await set(ref(db, 'users/' + sEmail), data);
            initApp(data);
        };

        window.handleLogin = async () => {
            let email = document.getElementById('userEmail').value.trim();
            let pass = document.getElementById('userPass').value.trim();
            let sEmail = email.replace(/\./g, ',');
            const snap = await get(ref(db, 'users/'+sEmail));
            if(snap.exists() && snap.val().password === pass) initApp(snap.val());
            else alert("‡§ó‡§≤‡§§ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏!");
        };

        function initApp(userData) {
            window.currentUser = userData;
            localStorage.setItem('earnings_user', userData.email);
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('bottomNav').style.display = 'flex';
            document.getElementById('userDisplay').innerText = userData.email;
            document.getElementById('displayMyCode').innerText = userData.myReferCode;

            let sEmail = userData.email.replace(/\./g, ',');
            onValue(ref(db, 'users/'+sEmail), (s) => {
                if(s.exists()){
                    let d = s.val();
                    window.bal = d.balance || 0;
                    window.daily.spins = d.spins || 0;
                    window.daily.captchas = d.captchas || 0;
                    document.getElementById('balHome').innerText = window.bal;
                    document.getElementById('balWithdraw').innerText = window.bal;
                    document.getElementById('sCount').innerText = window.daily.spins+"/3";
                    document.getElementById('cCount').innerText = window.daily.captchas+"/3";
                    if(d.withdrawn_10) document.getElementById('wb10').classList.add('hidden-btn');
                }
            });
            genCap(); loadAdminApps(); loadHistory();
        }

        // --- DYNAMIC APPS ---
        function loadAdminApps() {
            onValue(ref(db, 'customApps'), (snap) => {
                const list = document.getElementById('dynamicAppList');
                list.innerHTML = "";
                if(snap.exists()) {
                    Object.values(snap.val()).forEach(app => {
                        list.innerHTML += `
                        <div class="dyn-card">
                            <img src="${app.logo || 'https://cdn-icons-png.flaticon.com/512/2111/2111463.png'}" class="app-img">
                            <div class="app-info"><b>${app.name}</b><br><small>${app.sub}</small></div>
                            <div class="app-reward">${app.reward}</div>
                            <button onclick="window.open('${app.link}', '_blank')" style="background:#e67e22; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold;">Install</button>
                        </div>`;
                    });
                }
            });
        }

        // --- TASKS ---
        window.doSpin = async () => {
            if(window.daily.spins >= 3) return alert("Limit Complete!");
            let win = Math.floor(Math.random() * 3) + 1;
            let deg = 1800 + (win * 120);
            document.getElementById('wheel').style.transform = `rotate(${deg}deg)`;
            setTimeout(async () => {
                let sEmail = window.currentUser.email.replace(/\./g, ',');
                await update(ref(db, 'users/'+sEmail), { balance: window.bal + win, spins: window.daily.spins + 1 });
                alert("Won ‚Çπ" + win);
                document.getElementById('wheel').style.transform = `rotate(0deg)`;
            }, 4000);
        };

        function genCap() {
            currentCaptcha = Math.random().toString(36).substring(2,7).toUpperCase();
            document.getElementById('capCode').innerText = currentCaptcha;
        }
        window.doCaptcha = async () => {
            if(window.daily.captchas >= 3) return alert("Limit!");
            if(document.getElementById('capInput').value.trim().toUpperCase() === currentCaptcha) {
                let sEmail = window.currentUser.email.replace(/\./g, ',');
                await update(ref(db, 'users/'+sEmail), { balance: window.bal + 1, captchas: window.daily.captchas + 1 });
                document.getElementById('capInput').value = ""; genCap();
            }
        };

        // --- WALLET ---
        window.selectWAmt = (amt) => {
            window.selectedWAmt = amt;
            document.querySelectorAll('.w-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('wb' + amt).classList.add('selected');
        };

        window.handleWithdraw = async () => {
            let upi = document.getElementById('upiId').value;
            let amt = window.selectedWAmt;
            if(!upi || amt <= 0) return alert("UPI ID ‡§î‡§∞ Amount ‡§ö‡•Å‡§®‡•á‡§Ç!");
            if(window.bal < amt) return alert("‡§¨‡•à‡§≤‡•á‡§Ç‡§∏ ‡§ï‡§Æ ‡§π‡•à!");
            let sEmail = window.currentUser.email.replace(/\./g, ',');
            let upData = { balance: window.bal - amt };
            if(amt === 10) upData.withdrawn_10 = true;
            await set(push(ref(db, 'withdrawals')), { user: window.currentUser.email, amount: amt, upi, status: "Pending", date: Date.now() });
            await update(ref(db, 'users/'+sEmail), upData);
            alert("‡§µ‡§ø‡§•‡§°‡•ç‡§∞‡•â ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§≠‡•á‡§ú ‡§¶‡•Ä ‡§ó‡§à!");
        };

        function loadHistory() {
            onValue(ref(db, 'withdrawals'), (s) => {
                let h = "";
                if(s.exists()){
                    Object.values(s.val()).reverse().forEach(r => {
                        if(r.user === window.currentUser.email) h += `<div style="border-bottom:1px solid #ddd; padding:10px;">‚Çπ${r.amount} - <span style="color:orange">${r.status}</span></div>`;
                    });
                }
                document.getElementById('withdrawHistory').innerHTML = h || "No data";
            });
        }

        window.copyRefer = () => {
            const msg = `Download App: ${window.location.href}\nUse Code: ${window.currentUser.myReferCode}\nEarn ‚Çπ10 Now!`;
            navigator.clipboard.writeText(msg); alert("Copied!");
        };

        window.showCol = (id, nId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(nId){ document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav')); document.getElementById(nId).classList.add('active-nav'); }
        };
        window.openAdmin = () => { if(prompt("Pass:")==="admin123") showCol('adminPage'); };
        window.toggleModal = (id, o) => document.getElementById(id).style.display = o?'block':'none';

        window.onload = async () => {
            let email = localStorage.getItem('earnings_user');
            if(email){
                let sEmail = email.replace(/\./g, ',');
                const snap = await get(ref(db, 'users/'+sEmail));
                if(snap.exists()) initApp(snap.val()
